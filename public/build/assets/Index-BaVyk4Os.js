import{d as s,i as P,e as i,o as r,a as t,t as d,c as S,w as j,b as E,u as I,Z as N,F as m,h as b,k as O}from"./app-vGR4VHCP.js";import{L as U}from"./LayoutFranqueado-Dg4kLBEk.js";import{p as V}from"./chartjs-plugin-datalabels.esm-EXrChiyj.js";import{C as L,A as G,p as T,a as W,D as Z,P as q,B as z,L as H,R as J,b as K,c as Q,d as X,e as tt,f as et,g as at,h as st,i as ot}from"./chart-D2B5U74o.js";import{d as M}from"./dayjs.min-CqG6kpIn.js";import"./pt-br-D1Z5XoE6.js";import{_ as lt}from"./_plugin-vue_export-helper-DlAUqK2U.js";const rt={class:"flex items-center space-x-2"},nt={class:"font-semibold text-gray-900 text-[17px]"},it={__name:"CalendarFilterDre",emits:["update-filters"],setup(Y,{emit:x}){M.locale("pt-br");const h=x,n=s(M()),v=()=>{n.value=n.value.subtract(1,"month"),o()},_=()=>{n.value=n.value.add(1,"month"),o()},o=()=>{const u=n.value.startOf("month").format("DD-MM-YYYY"),p=n.value.endOf("month").format("DD-MM-YYYY");h("update-filters",{startDate:u,endDate:p})};return P(()=>{o()}),(u,p)=>(r(),i("div",rt,[t("button",{onClick:v,class:"p-2 rounded hover:bg-gray-200 text-gray-700 font-semibold"}," < "),t("span",nt,d(n.value.format("MMMM YYYY")),1),t("button",{onClick:_,class:"p-2 rounded hover:bg-gray-200 text-gray-700 font-semibold"}," > ")]))}},dt={class:"flex justify-end mb-4"},ct={class:"text-[#262a27] text-[15px] font-semibold font-['Figtree'] leading-tight"},ut={class:"flex items-center space-x-2 justify-end"},pt={class:"text-gray-900 text-[17px] font-semibold"},gt={class:"mt-5"},mt={class:"grid grid-cols-2 grid-rows-1 gap-4"},xt={class:"rounded-lg"},ht={class:"w-full text-left text-[14px] border-collapse font-['Figtree']"},vt={key:0},_t={key:1},ft={class:"px-5 py-2 text-right valores"},bt={class:"bg-[#174111] text-white"},yt={colspan:"2",class:"p-1 px-5"},Ft={class:"p-1 px-5 categorias align-middle"},Ct={class:"px-5 py-1 text-right valores"},Dt={class:"bg-[#174111] text-white"},wt={colspan:"1",class:"p-2 text-right font-bold"},kt={class:"mt-5"},Rt={class:"bg-white rounded-lg shadow"},Bt={ref:"scrollContainer",class:"overflow-y-auto max-h-96 scroll-hidden"},Et={class:"space-y-2"},Lt={class:"text-center px-5 text-gray-600 font-semibold"},Mt={class:"text-center text-gray-600 font-medium"},Pt={class:"text-right text-gray-600 font-semibold"},Yt={__name:"Index",setup(Y){const x=s("0,00"),h=s("0,00"),n=s([]),v=s([]),_=s(!0),o=s("pie");let u=null;const p=s([]),y=s([]),F=s([]),D=s([]),w=s([]),k=s([]),$=c=>{console.log("Filtros atualizados:",c),R(c.startDate,c.endDate)},R=async(c,e)=>{try{const l=(await O.get("/api/painel-dre/analitycs-dre",{params:{start_date:c,end_date:e}})).data;x.value=l.total_caixas||"0,00",h.value=l.resultado_do_periodo||"0,00",n.value=l.grupos||[],v.value=l.calendario||[],y.value=[],p.value=[],F.value=[],D.value=[],w.value=[],k.value=[],l.grupos.forEach(g=>{(Array.isArray(g.categorias)?g.categorias:Object.values(g.categorias)).forEach(f=>{const B=parseFloat(f.total.replace(".","").replace(",",".")),C=f.porcentagem;D.value.push(f.categoria),w.value.push(B),k.value.push(C),C!=="0,00%"&&(y.value.push(f.categoria),p.value.push(B),F.value.push(C))})}),A()}catch(a){console.error("Erro ao buscar os dados do DRE:",a)}finally{_.value=!1}};L.register(G,T,W,Z,q,z,H,J,K,Q,X,tt,et,at,st,ot,V);const A=()=>{const c=document.getElementById("myChart").getContext("2d");u&&u.destroy();const e={type:o.value,data:{labels:y.value,datasets:[{data:p.value,backgroundColor:["#6DB631","#FF9500","#FF2D55","#5856D6","#F7464A","#FF7F50"],borderColor:o.value==="line"?"#36A2EB":void 0,borderWidth:o.value==="line"||o.value==="bar"?1:0,fill:o.value==="line"}]},options:{plugins:{tooltip:{callbacks:{label:function(a){const l=new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(a.raw),g=F.value[a.dataIndex];return`${a.label}: ${l} (${g})`}}},legend:{position:"bottom",labels:{usePointStyle:!0,padding:15,boxWidth:10}},datalabels:{display:!1}},scales:o.value==="bar"||o.value==="line"?{x:{type:"category"},y:{beginAtZero:!0,ticks:{callback:function(a){return new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(a)}}}}:void 0}};u=new L(c,e)};return P(R),(c,e)=>(r(),S(U,null,{default:j(()=>[E(I(N),{title:"Painel"}),e[7]||(e[7]=t("div",{class:"painel-title"},"DRE Gerencial",-1)),e[8]||(e[8]=t("div",{class:"painel-subtitle"},[t("p",null,"Acompanhe a saúde da sua operação")],-1)),t("div",dt,[t("div",ct,[t("div",ut,[t("span",pt,[E(it,{onUpdateFilters:$})])])])]),t("div",gt,[t("div",mt,[t("div",xt,[t("table",ht,[e[3]||(e[3]=t("thead",null,[t("tr",{class:"bg-[#174111] text-white"},[t("th",{colspan:"2",class:"p-1 px-5"},"Faturamento do Período")])],-1)),_.value?(r(),i("tbody",vt,[(r(),i(m,null,b(25,a=>t("tr",{key:a},e[0]||(e[0]=[t("td",{class:"p-1 px-5 shimmer h-6 w-1/2 rounded"},null,-1),t("td",{class:"p-1 px-5 shimmer h-6 w-1/4 rounded text-right"},null,-1)]))),64))])):(r(),i("tbody",_t,[t("tr",null,[e[1]||(e[1]=t("td",{class:"p-1 px-5 categorias"},"Faturamento do Período",-1)),t("td",ft," R$ "+d(x.value),1)])])),(r(!0),i(m,null,b(n.value,a=>(r(),i(m,{key:a.nome_grupo},[t("thead",null,[t("tr",bt,[t("th",yt,d(a.nome_grupo),1)])]),t("tbody",null,[(r(!0),i(m,null,b(a.categorias,l=>(r(),i("tr",{key:l.categoria,class:"odd:bg-gray-100 even:bg-white p-1 px-5"},[t("td",Ft,d(l.categoria),1),t("td",Ct," R$ "+d(l.total),1)]))),128))])],64))),128)),t("thead",null,[t("tr",Dt,[e[2]||(e[2]=t("th",{colspan:"1",class:"p-2"},"Resultado do Período",-1)),t("th",wt," R$ "+d(h.value),1)])])])]),t("div",null,[e[6]||(e[6]=t("div",{class:"bg-white rounded-lg p-5 flex justify-center w-full h-[480px]"},[t("canvas",{id:"myChart"})],-1)),t("div",kt,[e[5]||(e[5]=t("div",{class:"flex items-center justify-between"},[t("h3",{class:"text-[#262a27] text-[17px] font-semibold font-['Figtree'] leading-snug"}," Histórico de Resultados ")],-1)),t("div",Rt,[e[4]||(e[4]=t("div",{class:"bg-[#164110] grid grid-cols-3 gap-4 py-2 px-6 text-xs font-semibold text-[#FFFFFF] uppercase tracking-wider rounded-tl-2xl rounded-tr-2xl"},[t("span",{class:"text-center px-5"},"MÊS"),t("span",{class:"text-center"},"CMV"),t("span",{class:"text-right"},"RESULTADO")],-1)),t("div",Bt,[t("ul",Et,[(r(!0),i(m,null,b(v.value,a=>(r(),i("li",{key:a.nome_mes,class:"hover:bg-gray-200 grid grid-cols-3 gap-4 px-6 text-[14px]"},[t("span",Lt,d(a.nome_mes),1),t("span",Mt," R$ "+d(a.categorias[0].valor_cmv),1),t("span",Pt," R$ "+d(a.categorias[0].resultado_do_periodo),1)]))),128))])],512)])])])])])]),_:1}))}},Vt=lt(Yt,[["__scopeId","data-v-39125712"]]);export{Vt as default};
