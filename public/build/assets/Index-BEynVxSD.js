import{L as G}from"./LayoutFranqueado-Dg4kLBEk.js";import{e as i,o as n,f as w,a as e,t as f,l as T,d as m,q as z,m as A,x as H,F as D,h as L,b as q,g as C,k as V,j as J,i as Z,v as j,u as O,c as E,w as W,Z as X}from"./app-vGR4VHCP.js";import{_ as Y}from"./LabelModel-BQtPKLWR.js";import{_ as B}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{I as ee}from"./InputModel-BvMn92CJ.js";import{B as te}from"./ButtonCancelar-DXabxgHh.js";import{B as Q}from"./ButtonPrimaryMedio-C9HfT39S.js";import{d as oe}from"./index-CWjNdAPT.js";const ae={class:"login-btn-text w-full"},re=["src"],se={class:"text-center text-[15px] font-semibold font-['Figtree'] leading-tight"},ne={__name:"ButtonPrimaryCarrinho",props:{text:{type:String,default:"Label"},iconPath:{type:String,required:!1}},setup(g){return($,u)=>(n(),i("button",ae,[g.iconPath?(n(),i("img",{key:0,src:g.iconPath,alt:"icon",class:"h-6 w-6 mr-2"},null,8,re)):w("",!0),e("span",se,f(g.text),1)]))}},ie=B(ne,[["__scopeId","data-v-75ecbfc3"]]),de={key:0,class:"elemento-fixo"},le={class:"mb-6 relative"},ce={class:"relative"},ue=["disabled"],pe=["value"],me={class:"w-full h-[150px] bg-white rounded-[20px] p-12"},fe={class:"relative w-full h-full"},ge={class:"flex items-center"},ve={class:"w-1/1 flex justify-center"},xe=["src"],_e={class:"w-2/3 pl-5"},he={class:"text-[#262a27] text-[28px] font-bold font-['Figtree'] leading-[30px] tracking-tight"},ye={key:0,class:"mt-8"},be={class:"min-w-full table-auto"},we={class:"px-6 py-4 text-[15px] font-semibold text-gray-500 uppercase tracking-wider"},$e={key:0,class:"text-center"},ke={class:"px-6 py-4 text-[16px] text-gray-500 font-semibold"},Fe={class:"px-6 py-4 text-[16px] text-gray-500 font-semibold"},Pe={class:"px-6 py-4 text-[16px] text-gray-500 font-semibold"},Ce={key:2,class:"text-center"},qe={class:"mt-12"},De={class:"up w-full text-[#6d6d6d] text-[15px] font-semibold"},Le={class:"mt-5 flex gap-2"},Be={__name:"DetalhesProdutoPedidos",props:{produto:{type:Object,required:!0}},emits:["adicionarAoCarrinho"],setup(g,{emit:$}){const u=T(),p=g,d=m({precos:[]}),_=$,h=m(!1),k=m(!1),F=m(!1),P=m([]),a=m(""),r=m(""),v=()=>{_("finalizar")},x=()=>{if(!a.value){u.warning("Por favor, selecione o fornecedor!");return}if(!r.value||parseFloat(r.value)<=0){u.warning("É necessário informar uma quantidade válida (maior que 0)!");return}if(!d.value||!d.value.precos){u.error("Houve um erro com o produto, tente novamente ou chame o suporte.");return}const t=d.value.precos.find(M=>M.fornecedor_id===a.value);if(!t){u.warning("Este fornecedor não está disponível no momento!");return}const o=t.qtd_minima,l=parseFloat(r.value),b=typeof o=="string"?parseFloat(o.replace(",",".")):o;if(l<b){u.warning(`A quantidade mínima para este fornecedor precisa ser acima de ${b}.`);return}const S=P.value.find(M=>M.id===a.value),K=t?t.preco_unitario:0,N={id:d.value.id,nome:d.value.nome,unidadeDeMedida:d.value.unidadeDeMedida,fornecedorId:a.value,nomeFornecedor:S?S.razao_social:"Fornecedor desconhecido",quantidade:d.value.unidadeDeMedida==="unitario"?parseInt(r.value):parseFloat(r.value).toFixed(3),preco:K};console.info("item adicionado",N),_("adicionarAoCarrinho",N),u.success("Item adicionado a sua lista de pedido."),r.value="",F.value=!0};(async()=>{try{const t=await V.get("/api/estoque/fornecedores");P.value=t.data.data.map(o=>({id:o.id||"N/D",razao_social:o.razao_social||"N/D"}))}catch(t){console.error("Erro ao carregar fornecedores:",t)}})();const I=t=>Number(t).toLocaleString("pt-BR",{style:"currency",currency:"BRL"}),U=(t,o)=>t==="unitario"?parseInt(o):t==="a_granel"?parseFloat(o).toLocaleString("pt-BR",{minimumFractionDigits:3,maximumFractionDigits:3}):o,R=(t,o)=>{if(!o.trim())return"";if(t==="unitario")return o.replace(/\D/g,"");if(t==="a_granel"){let l=o.replace(/\D/g,"");if(!l)return"";let b=l.slice(0,-3)||"0",S=l.slice(-3).padStart(3,"0");return`${Number(b).toLocaleString("pt-BR")},${S}`}return o},c=async()=>{h.value=!0;try{if(p.produto&&p.produto.id){const o=(await V.get("/api/produtos/lista")).data,l=Object.values(o).flatMap(b=>b.produtos);d.value=l.find(b=>b.id===p.produto.id)||{}}}catch(t){console.error("Erro ao buscar o produto:",t)}finally{h.value=!1}},s=t=>t?new URL(t,window.location.origin).href:"/storage/images/no_imagem.svg";return z(()=>p.produto,()=>{c()},{immediate:!0}),z(r,t=>{r.value=R(p.produto.unidadeDeMedida,t)}),(t,o)=>k.value?w("",!0):(n(),i("div",de,[e("div",null,[o[3]||(o[3]=e("h3",{class:"text-xl font-bold mb-4 text-gray-500"}," Enviar pedido para o fornecedor ",-1)),e("div",le,[e("div",ce,[A(e("select",{"onUpdate:modelValue":o[0]||(o[0]=l=>a.value=l),id:"fornecedor",disabled:F.value,class:"w-full py-2 bg-transparent border border-gray-300 rounded-lg outline-none text-base text-center text-green-600 focus:ring-2 focus:ring-green-500 font-['Figtree']"},[o[2]||(o[2]=e("option",{value:"",disabled:""},"Selecione um fornecedor",-1)),(n(!0),i(D,null,L(P.value,l=>(n(),i("option",{key:l.id,value:l.id},f(l.razao_social),9,pe))),128))],8,ue),[[H,a.value]])])])]),e("div",me,[e("div",fe,[e("div",ge,[e("div",ve,[e("img",{src:s(g.produto.profile_photo),alt:"Foto do Produto",class:"w-20 h-20 rounded-md shadow-lg"},null,8,xe)]),e("div",_e,[e("div",he,f(g.produto.nome||"N/A"),1)])])])]),k.value?w("",!0):(n(),i("div",ye,[q(Y,{text:"valor por fornecedor",class:"tracking-wider uppercase"}),e("table",be,[e("thead",null,[e("tr",null,[o[4]||(o[4]=e("th",{class:"px-6 py-4 text-[15px] font-semibold text-gray-500 uppercase tracking-wider rounded-tl-2xl"}," Fornecedor ",-1)),e("th",we," Valor / "+f(g.produto.unidadeDeMedida==="unitario"?"Unidade":"Kg"),1),o[5]||(o[5]=e("th",{class:"px-6 py-4 text-[15px] font-semibold text-gray-500 uppercase tracking-wider rounded-tr-2xl"}," QTD.Mínima ",-1))])]),e("tbody",null,[h.value?(n(),i("tr",$e,o[6]||(o[6]=[e("td",{colspan:"2",class:"px-6 py-4 text-[16px] text-gray-500 font-semibold"},[e("div",{class:"flex justify-center items-center"},[e("svg",{class:"animate-spin h-5 w-5 mr-3 text-gray-500",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v8H4z"})]),C(" Carregando... ")])],-1)]))):d.value.precos&&d.value.precos.length>0?(n(!0),i(D,{key:1},L(d.value.precos,(l,b)=>(n(),i("tr",{key:b,class:"text-center"},[e("td",ke,f(l.fornecedor),1),e("td",Fe,f(I(l.preco_unitario)),1),e("td",Pe,f(U(d.value.unidadeDeMedida,l.qtd_minima)),1)]))),128)):(n(),i("tr",Ce,o[7]||(o[7]=[e("td",{colspan:"2",class:"px-6 py-4 text-[16px] text-gray-500 font-semibold"}," Nenhum preço disponível para este produto. ",-1)])))])])])),e("div",qe,[e("label",De,f(g.produto.unidadeDeMedida==="unitario"?"Unitário":"A Granel"),1),q(ee,{modelValue:r.value,"onUpdate:modelValue":o[1]||(o[1]=l=>r.value=l),placeholder:g.produto.unidadeDeMedida==="unitario"?"0":"0,000"},null,8,["modelValue","placeholder"])]),e("div",Le,[q(ie,{disabled:h.value,text:"adicionar ao carrinho",iconPath:"/storage/images/carrinho.svg",onClick:x,class:"uppercase"},null,8,["disabled"]),q(Q,{class:"w-full",text:"Finalizar Pedido",iconPath:"/storage/images/arrow_left_alt.svg",onClick:v})])]))}},Ie=B(Be,[["__scopeId","data-v-d8900958"]]),Re={class:"search-container relative flex items-center w-full mb-4"},Se={class:"category-container card-container compromissos-container overflow-hidden"},Ue={class:"w-full h-[18.63px] text-[#6d6d6d] text-[15px] font-semibold font-['Figtree'] leading-tight mt-8 mb-1"},Me={class:"card-container"},Ee=["onClick"],Ve={class:"card-inner"},Ae={class:"icon-container"},Ne={class:"icon-leaf"},ze=["src"],Te={class:"text-container"},je={class:"city"},Oe={key:0,class:"estrela"},Qe={__name:"ListarInsumosPedidos",emits:["produto-selecionado"],setup(g,{emit:$}){const u=$,p=m([]),d=m(""),_=async()=>{try{const a=await V.get("/api/produtos/lista");console.log("Produtos carregados:",a.data),typeof a.data=="object"&&a.data!==null?p.value=h(a.data):console.error("Esperava um objeto de categorias de produtos, mas recebi:",a.data)}catch(a){console.error("Erro ao carregar os produtos:",a)}};function h(a){const r=Object.keys(a),v={};return r.forEach(x=>{v[x]={categoria_nome:a[x].categoria_nome,produtos:a[x].produtos||[]}}),v}const k=a=>a?new URL(a,window.location.origin).href:"/storage/images/no_imagem.svg",F=J(()=>{const a=d.value.toLowerCase(),r={};return Object.keys(p.value).forEach(v=>{const x=p.value[v].produtos.filter(y=>y.nome.toLowerCase().includes(a));x.length>0&&(r[v]={categoria_nome:p.value[v].categoria_nome,produtos:x})}),r}),P=a=>{u("produto-selecionado",a)};return Z(_),(a,r)=>(n(),i("div",null,[r[4]||(r[4]=e("div",{class:"painel-title"},"Novo pedido",-1)),r[5]||(r[5]=e("div",{class:"painel-subtitle"},[e("p",null,"Efetuar novo pedido de insumos com fornecedor")],-1)),e("div",Re,[r[1]||(r[1]=e("div",{class:"absolute left-3"},[e("img",{src:"/storage/images/search.svg",alt:"Ícone de pesquisa",class:"w-5 h-5 text-gray-500"})],-1)),A(e("input",{type:"text","onUpdate:modelValue":r[0]||(r[0]=v=>d.value=v),placeholder:"Buscar um produto",class:"search-input pl-10 w-full py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500"},null,512),[[j,d.value]])]),e("div",Se,[(n(!0),i(D,null,L(F.value,(v,x)=>(n(),i("div",{key:x,class:"categoria-group"},[e("div",Ue,f(x),1),e("div",Me,[(n(!0),i(D,null,L(v.produtos,y=>(n(),i("div",{key:y.id,class:"card cursor-pointer transform transition-transform duration-200 hover:shadow-lg",onClick:I=>P(y)},[e("div",Ve,[e("div",Ae,[r[2]||(r[2]=e("div",{class:"icon-bg"},null,-1)),e("div",Ne,[e("img",{src:k(y.profile_photo),alt:"Imagem do produto",class:"w-12 h-12 rounded-lg"},null,8,ze)])]),e("div",Te,[e("div",je,[C(f(y.nome)+" ",1),y.estrela?(n(),i("span",Oe,"★")):w("",!0)])]),r[3]||(r[3]=e("div",{class:"action-icon"},null,-1))])],8,Ee))),128))])]))),128))])]))}},Ke=B(Qe,[["__scopeId","data-v-d30fab9c"]]),Ge={class:"flex gap-5"},He={key:0,class:"loading-overlay"},Je={class:"flex-1"},Ze={class:"mt-[20%] text-[#6d6d6d] text-[18px] font-normal font-['Figtree'] leading-[23px] tracking-tight"},We={class:"text-[#6db631] text-xl font-bold font-['Figtree'] leading-[25px] tracking-tight mt-12"},Xe={class:"flex-1"},Ye={class:"min-w-full table-auto"},et=["onDblclick"],tt={class:"px-6 py-4 text-[16px] text-left text-gray-500 font-semibold"},ot={class:"px-6 py-4 text-[16px] text-gray-500 font-semibold text-center"},at=["onUpdate:modelValue"],rt={key:1},st={class:"px-6 py-4 text-[16px] text-gray-500 font-semibold text-left"},nt={class:"px-6 py-4 text-[16px] text-gray-500 text-center font-semibold"},it={class:"px-6 py-4 text-center"},dt=["onClick"],lt={class:"bg-[#e4f6de]"},ct={class:"px-6 py-4 text-[16px] text-center text-gray-500 font-semibold"},ut={key:0,class:"botao-container"},pt={__name:"ResumoCarrinhoPedidos",props:{carrinho:{type:Array,required:!0}},emits:["confirmar","cancelar"],setup(g,{emit:$}){var R;const u=T(),p=g,d=$,_=m(!1),h=m(!1),k=m(null),F=((R=p.carrinho[0])==null?void 0:R.nomeFornecedor)||"Sem fornecedor",P=c=>{p.carrinho.splice(c,1),u.info("Item removido com sucesso!")},a=c=>{k.value=c},r=c=>{const s=Number(c.quantidade)||0;return c.unidadeDeMedida==="a_granel"?s.toLocaleString("pt-BR",{minimumFractionDigits:3,maximumFractionDigits:3})+" KG":s.toLocaleString("pt-BR",{maximumFractionDigits:0})+" UN"},v=c=>(Number(c.preco)||0).toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2}),x=c=>(c.quantidade||0)*(c.preco||0),y=()=>p.carrinho.reduce((c,s)=>c+(s.quantidade||0)*(s.preco||0),0),I=async()=>{_.value=!0,h.value=!1;try{const c={itens:p.carrinho.map(t=>({fornecedor_id:t.fornecedorId,id:t.id,nome:t.nome,nomeFornecedor:t.nomeFornecedor,quantidade:parseFloat(t.quantidade),valor_unitario:parseFloat(t.preco),valor_total_item:x(t),unidadeDeMedida:t.unidadeDeMedida})),valor_total_carrinho:parseFloat(y()),nomePrimeiroFornecedor:F};console.log("Dados a ser enviado:",JSON.stringify(c,null,2));const s=await axios.post("/api/estoque/criar-pedido",c);s.status===201?(console.log("Resposta da API:",s.data),u.success("Lista de itens está sendo enviada."),oe.Inertia.visit(route("franqueado.inventario"))):u.error("Erro ao enviar os itens.")}catch(c){console.error("Erro ao enviar:",c),u.error("Erro ao confirmar o envio. Tente novamente ou chame o suporte.")}finally{_.value=!1}},U=()=>{d("cancelar")};return(c,s)=>(n(),i("div",Ge,[_.value?(n(),i("div",He,s[0]||(s[0]=[e("div",{class:"spinner"},null,-1)]))):w("",!0),e("div",Je,[s[2]||(s[2]=e("div",{class:"painel-title"},"Confirmar pedido",-1)),s[3]||(s[3]=e("div",{class:"painel-subtitle"},[e("p",null,"Verifique seu pedido antes de enviar")],-1)),e("div",Ze,[s[1]||(s[1]=e("p",null,[C(" Verifique se o seu pedido "),e("br"),C(" está correto antes de enviar "),e("br"),C(" para o fornecedor ")],-1)),e("span",We,f(O(F)||"Fornecedor desconhecido")+". ",1)]),s[4]||(s[4]=e("div",{class:"mt-[20%] text-[#ff2d55] text-[15px] font-normal font-['Figtree'] leading-[18px] tracking-tight"},[e("p",null,[C(" * valor atualizado semanalmente, "),e("br"),C(" podendo sofrer alterações, confirme "),e("br"),C(" com o fornecedor no ato do envio do pedido. ")])],-1))]),e("div",Xe,[e("table",Ye,[s[8]||(s[8]=e("thead",null,[e("tr",null,[e("th",{class:"px-6 py-3 text-xs text-left font-medium text-gray-500 uppercase tracking-wider TrRedonEsquerda"}," Item "),e("th",{class:"px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider"}," QTD. "),e("th",{class:"px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider"}," V. UN/KG "),e("th",{class:"px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider"}," TOTAL "),e("th",{class:"px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider TrRedonDireita"}," AÇÃO ")])],-1)),e("tbody",null,[(n(!0),i(D,null,L(g.carrinho,(t,o)=>(n(),i("tr",{key:t.id,onDblclick:l=>a(o)},[e("td",tt,f(t.nome),1),e("td",ot,[k.value===o?A((n(),i("input",{key:0,type:"number","onUpdate:modelValue":l=>t.quantidade=l,class:"border border-gray-300 rounded px-2 py-1 w-16"},null,8,at)),[[j,t.quantidade,void 0,{number:!0}]]):(n(),i("span",rt,f(r(t)),1))]),e("td",st," R$ "+f(v(t).toLocaleString("pt-BR",{minimumFractionDigits:2})),1),e("td",nt," R$ "+f(x(t).toLocaleString("pt-BR",{minimumFractionDigits:2})),1),e("td",it,[e("button",{onClick:l=>P(o),class:"w-[16] h-[16]"},s[5]||(s[5]=[e("img",{src:"/storage/images/delete.svg",alt:"icone de excluir",class:"w-[16px] h-[16px]"},null,-1)]),8,dt)])],40,et))),128)),e("tr",lt,[s[6]||(s[6]=e("td",{class:"px-6 py-8 text-[16px] text-left text-gray-500 font-semibold",colspan:"3"}," Total do Pedido ",-1)),e("td",ct," R$ "+f(y(c.item).toLocaleString("pt-BR",{minimumFractionDigits:2})),1),s[7]||(s[7]=e("td",null,null,-1))])])]),h.value?w("",!0):(n(),i("div",ut,[q(te,{text:"Voltar",onClick:U}),q(Q,{text:"Confirmar",onClick:I})]))])]))}},mt=B(pt,[["__scopeId","data-v-ce81cd87"]]),ft={key:0,class:"mt-6"},gt={class:"grid grid-cols-1 gap-[3rem] mt-3 sm:grid-cols-2 card-container h-full overflow-hidden"},vt={key:0},xt={class:"flex flex-col gap-4"},_t={__name:"Index",setup(g){const $=m([]),u=m(null),p=m(0),d=m(!1);m(!1);const _=()=>{d.value=!d.value},h=a=>{$.value.push(a)},k=()=>{console.log("atualizando a lista"),u.value=null,p.value+=1},F=()=>{var r;(r=m("listarUnidades").value)==null||r.fetchUnidades()},P=a=>{u.value=a,console.info("Dados recebidos produto-selecionado:",a)};return(a,r)=>(n(),E(G,null,{default:W(()=>[q(O(X),{title:"Novo Pedido"}),d.value?(n(),i("div",ft,[q(mt,{carrinho:$.value,isVisible:d.value,onCancelar:_},null,8,["carrinho","isVisible"])])):w("",!0),e("div",gt,[d.value?w("",!0):(n(),i("div",vt,[(n(),E(Ke,{key:p.value,ref:"listarUnidades",onUnidadeCadastrada:F,onProdutoSelecionado:P}))])),e("div",xt,[d.value?w("",!0):(n(),i(D,{key:0},[u.value?(n(),E(Ie,{key:0,onAtualizar:k,produto:u.value,onFinalizar:_,onAdicionarAoCarrinho:h},null,8,["produto"])):w("",!0)],64))])])]),_:1}))}},Ct=B(_t,[["__scopeId","data-v-c37af3fc"]]);export{Ct as default};
