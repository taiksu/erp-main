import{A as W}from"./LayoutFranqueadora-DZJsUdwc.js";import{e as m,o as n,a as e,m as P,v as Y,F as k,h as j,t as w,k as F,l as L,d as r,f as D,b as c,c as q,w as N,p as V,x as ee,s as se,u as oe,Z as ae}from"./app-vGR4VHCP.js";import{B as M}from"./ButtonPrimaryMedio-C9HfT39S.js";import{_ as S}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{d as z}from"./index-CWjNdAPT.js";import{C as A}from"./ConfirmDialog-1acut7He.js";import{I}from"./InputModel-BvMn92CJ.js";import{_ as U}from"./LabelModel-BQtPKLWR.js";import{B as te}from"./ButtonCancelar-DXabxgHh.js";import"./user-BrYGJ_Un.js";const re={data(){return{usuarios:[],searchQuery:""}},mounted(){this.fetchUsuarios()},methods:{async fetchUsuarios(){try{const a=await F.get("/api/usuarios");this.usuarios=a.data.filter(o=>!o.colaborador)}catch(a){console.error("Erro ao carregar usuários:",a)}},selecionarUsuario(a){this.$emit("usuario-selecionado",a)},getInitials(a){return a?a.split(" ").map(i=>i[0]).join("").slice(0,2).toUpperCase():"N/A"}},computed:{usuariosComFotos(){return this.usuarios.map(a=>({...a,profilePhoto:a.profile_photo_url||`https://ui-avatars.com/api/?name=${this.getInitials(a.name)}&color=7F9CF5&background=EBF4FF&size=55`}))},filteredUsuarios(){return this.usuariosComFotos.filter(a=>{const o=this.searchQuery.toLowerCase();return a.name.toLowerCase().includes(o)||a.cpf.toLowerCase().includes(o)})}}},le={class:"search-container relative flex items-center w-full mb-4"},ie={class:"card-container"},ne=["onClick"],de={class:"card-inner"},ue={class:"icon-container"},ce={class:"icon-leaf"},pe=["src"],fe={class:"text-container"},ve={class:"city"},me={class:"owner"};function ge(a,o,i,g,f,v){return n(),m("div",null,[o[4]||(o[4]=e("div",{class:"painel-title"},"Franqueados",-1)),o[5]||(o[5]=e("div",{class:"painel-subtitle"},[e("p",null,"Visualize os gestores das unidades")],-1)),e("div",le,[o[1]||(o[1]=e("div",{class:"absolute left-3"},[e("img",{src:"/storage/images/search.svg",alt:"Ícone de pesquisa",class:"w-5 h-5 text-gray-500"})],-1)),P(e("input",{type:"text","onUpdate:modelValue":o[0]||(o[0]=l=>f.searchQuery=l),placeholder:"Buscar um fornecedor",class:"search-input pl-10 w-full py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500"},null,512),[[Y,f.searchQuery]])]),e("div",ie,[(n(!0),m(k,null,j(v.filteredUsuarios,l=>(n(),m("div",{key:l.id,class:"card cursor-pointer transform transition-transform duration-200 hover:shadow-lg",onClick:d=>v.selecionarUsuario(l)},[e("div",de,[e("div",ue,[o[2]||(o[2]=e("div",{class:"icon-bg"},null,-1)),e("div",ce,[e("img",{src:l.profilePhoto,alt:"Foto de perfil",class:"w-12 h-12 rounded-lg"},null,8,pe)])]),e("div",fe,[e("div",ve,w(l.name),1),e("div",me,w(l.cpf),1)]),o[3]||(o[3]=e("div",{class:"action-icon"},null,-1))])],8,ne))),128))])])}const he=S(re,[["render",ge],["__scopeId","data-v-4bf08e62"]]),_e={key:0,class:"w-full h-[270px] bg-white rounded-[20px] p-12 relative overflow-y-auto scrollbar-hidden"},be={class:"relative w-full h-full"},ye={class:"flex items-center"},xe={class:"w-1/1 flex justify-center"},Ce=["src"],we={class:"w-2/3 pl-5"},$e={class:"text-[#262a27] text-[28px] font-bold font-['Figtree'] leading-[30px] tracking-tight"},Ue={class:"owner"},ke={class:"w-1/1"},Fe={class:"mt-4"},Ve={class:"w-full p-4 bg-transparent border border-gray-300 rounded-lg outline-none text-base text-gray-700 focus:ring-2 focus:ring-green-500 font-['Figtree']"},Ie={class:"text-[#262a27] text-base font-semibold font-['Figtree'] leading-[13px] tracking-tight"},qe={__name:"DetalhesUsuario",props:{usuario:{type:Object,required:!0}},setup(a){const o=L(),i=a,g=r(!1),f=r(""),v=r(!1),l=r(!1),d=async()=>{var b,p,x,C;try{l.value=!0;const _=await F.delete(`/api/usuarios/${i.usuario.id}`);console.log(_.data.message),o.success("Usuário deletado com sucesso!"),z.Inertia.replace(route("franqueadora.franqueados"),{preserveState:!0})}catch(_){o.error("Erro ao deletar o usuário:",((p=(b=_.response)==null?void 0:b.data)==null?void 0:p.error)||_.message),console.error("Erro ao deletar o usuário:",((C=(x=_.response)==null?void 0:x.data)==null?void 0:C.error)||_.message)}finally{l.value=!1}},h=b=>{f.value=b,g.value=!0},$=()=>{d(),g.value=!1},y=()=>{g.value=!1};return(b,p)=>v.value?D("",!0):(n(),m("div",_e,[e("div",be,[e("div",ye,[e("div",xe,[e("img",{src:a.usuario.profilePhoto||"/storage/images/default-profile.png",alt:"Foto do Usuário",class:"w-20 h-20 rounded-md shadow-lg"},null,8,Ce)]),e("div",we,[e("div",$e,w(a.usuario.name||"N/A"),1),e("div",Ue,"CPF: "+w(a.usuario.cpf),1)]),e("div",ke,[c(A,{isVisible:g.value,motivo:f.value,onConfirm:$,onCancel:y},null,8,["isVisible","motivo"]),e("div",{class:"absolute top-4 right-4 cursor-pointer",onClick:p[0]||(p[0]=x=>h("excluir franqueado"))},p[1]||(p[1]=[e("img",{src:"/storage/images/delete.svg",alt:"Deletar Usuário",class:"w-6 h-6"},null,-1)]))])]),e("div",Fe,[p[2]||(p[2]=e("p",{class:"p-2"},"E-mail",-1)),e("div",Ve,[e("div",Ie,w(a.usuario.email||"N/A"),1)])])])]))}},De=S(qe,[["__scopeId","data-v-0599d1de"]]),Se={key:0,class:"sidebar-container"},Ee={key:0,class:"loading-overlay"},Be={key:1,class:"w-full h-[525px] bg-white rounded-[20px] p-12"},Pe={class:"flex justify-center mb-6 relative group"},je=["src"],Le={key:1,src:"/storage/images/arrow_upload_ready.svg",alt:"Ícone de upload"},Ne={class:"w-full relative"},Me=["selected"],ze=["value"],Ae={class:"form-buttons"},Qe={__name:"CadastroFranqueado",props:{isVisible:{type:Boolean,required:!0}},emits:["cancelar"],setup(a,{emit:o}){const i=L(),g=o,f=r(""),v=r(""),l=r(""),d=r(""),h=r(""),$=r(null),y=r(null),b=r([]);r([]);const p=r(null),x=r(!1),C=r(!1),_=r("");(async()=>{try{const u=await F.get("/api/unidades");b.value=u.data.map(s=>({id:s.unidade.id,name:s.unidade.cidade||"Unidade Sem Nome"}))}catch{i.error("Erro ao carregar unidades.")}})();const Q=()=>{var u;(u=$.value)==null||u.click()},T=()=>{d.value="",i.info("Imagem removida.")},R=u=>{const s=u.target.files[0];if(s){p.value=s;const t=new FileReader;t.onload=()=>{d.value=t.result,i.success("Imagem carregada com sucesso!")},t.readAsDataURL(s)}},J=()=>{E(),g("cancelar")},E=()=>{f.value="",v.value="",l.value="",d.value="",y.value=null,p.value=null,h.value=""},O=()=>!f.value||!v.value||!l.value?(i.error("Por favor, preencha todos os campos obrigatórios."),h.value="Por favor, preencha todos os campos obrigatórios.",!1):!0,B=async()=>{var u,s;if(O())try{x.value=!0;const t=new FormData;t.append("name",f.value),t.append("email",v.value),t.append("cpf",l.value),t.append("unidade_id",y.value),p.value&&t.append("profile_photo",p.value);const K=await F.post("/api/usuarios",t,{headers:{"Content-Type":"multipart/form-data"}});z.Inertia.replace(route("franqueadora.franqueados"),{franqueado:K.data.franqueado,preserveState:!0}),i.success("Cadastro realizado com sucesso!"),E()}catch(t){i.error("Erro ao realizar o cadastro."),h.value=((s=(u=t.response)==null?void 0:u.data)==null?void 0:s.message)||"Erro ao realizar o cadastro."}finally{x.value=!1}},X=u=>{let s=u.target.value.replace(/\D/g,"");s.length>11&&(s=s.slice(0,11)),s=s.replace(/(\d{3})(\d{3})(\d{3})(\d{2})/,"$1.$2.$3-$4"),l.value=s},Z=u=>{_.value=u,C.value=!0},G=()=>{B(),C.value=!1},H=()=>{C.value=!1};return(u,s)=>(n(),q(se,{name:"fade"},{default:N(()=>[a.isVisible?(n(),m("div",Se,[x.value?(n(),m("div",Ee,s[6]||(s[6]=[e("div",{class:"spinner"},null,-1)]))):(n(),m("div",Be,[e("form",{onSubmit:V(B,["prevent"])},[e("div",Pe,[e("div",{class:"w-[110px] h-[110px] bg-[#f3f8f3] rounded-xl flex items-center justify-center cursor-pointer overflow-hidden relative",onClick:Q},[d.value?(n(),m(k,{key:0},[e("img",{src:d.value,alt:"Imagem selecionada",class:"w-full h-full object-cover"},null,8,je),e("div",{class:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity",onClick:s[0]||(s[0]=V(()=>{},["stop"]))},[e("button",{onClick:V(T,["stop"]),class:"w-8 h-8 bg-red-600 text-white rounded-full flex items-center justify-center font-bold text-sm"}," X ")])],64)):(n(),m("img",Le))]),e("input",{type:"file",ref_key:"fileInput",ref:$,accept:"image/*",class:"hidden",onChange:R},null,544)]),c(U,{text:"Nome Completo"}),c(I,{modelValue:f.value,"onUpdate:modelValue":s[1]||(s[1]=t=>f.value=t),placeholder:"João Silva Souza"},null,8,["modelValue"]),c(U,{text:"E-mail"}),c(I,{modelValue:v.value,"onUpdate:modelValue":s[2]||(s[2]=t=>v.value=t),placeholder:"usuario@email.com"},null,8,["modelValue"]),c(U,{text:"CPF"}),c(I,{modelValue:l.value,"onUpdate:modelValue":s[3]||(s[3]=t=>l.value=t),onInput:X,placeholder:"000.000.000-00"},null,8,["modelValue"]),c(U,{text:"Unidade Responsável"}),e("div",Ne,[P(e("select",{"onUpdate:modelValue":s[4]||(s[4]=t=>y.value=t),class:"w-full py-2 bg-transparent border border-gray-300 rounded-lg outline-none text-base text-center text-gray-700 focus:ring-2 focus:ring-green-500 font-['Figtree']"},[e("option",{value:"",disabled:"",selected:!y.value}," Selecione uma unidade ",8,Me),(n(!0),m(k,null,j(b.value,t=>(n(),m("option",{key:t.id,value:t.id},w(t.name),9,ze))),128))],512),[[ee,y.value]])]),c(A,{isVisible:C.value,motivo:_.value,onConfirm:G,onCancel:H},null,8,["isVisible","motivo"]),e("div",Ae,[c(te,{text:"Cancelar",onClick:J}),c(M,{text:"Cadastrar",onClick:s[5]||(s[5]=t=>Z("Criar novo Franqueado?"))})])],32)]))])):D("",!0)]),_:1}))}},Te=S(Qe,[["__scopeId","data-v-2166b4ba"]]),Re={class:"grid grid-cols-1 gap-[3rem] mt-3 sm:grid-cols-2"},Je={class:"flex flex-col gap-4"},Oe={class:"absolute bottom-4 right-4"},Xe={key:1,class:"mt-4"},rs={__name:"Index",setup(a){const o=r(null),i=r(!1),g=()=>{i.value=!i.value},f=()=>{v(),i.value=!1},v=()=>{var h;(h=r("listarUnidades").value)==null||h.fetchUnidades()},l=d=>{d&&typeof d=="object"?o.value=d:console.warn("Dados inválidos recebidos no evento usuario-selecionado:",d)};return(d,h)=>(n(),q(W,null,{default:N(()=>[c(oe(ae),{title:"Franqueados"}),e("div",Re,[e("div",null,[c(he,{ref:"listarUnidades",onUnidadeCadastrada:v,onUsuarioSelecionado:l},null,512)]),e("div",Je,[i.value?(n(),m("div",Xe,[c(Te,{isVisible:i.value,onUnidadeCadastrada:f,onCancelar:g},null,8,["isVisible"])])):(n(),m(k,{key:0},[o.value?(n(),q(De,{key:0,usuario:o.value},null,8,["usuario"])):D("",!0),e("div",Oe,[c(M,{text:"Novo Franqueado",iconPath:"/storage/images/arrow_left_alt.svg",onClick:g})])],64))])])]),_:1}))}};export{rs as default};
